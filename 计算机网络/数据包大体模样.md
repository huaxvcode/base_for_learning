---
title: 数据包大体模样
header-includes:
 - \usepackage{fvextra}
 - \DefineVerbatimEnvironment{Highlighting}{Verbatim}{breaklines,commandchars=\\\{\}}
output:
  pdf_document:
    latex_engine: xelatex
    toc: true
    template: C:/Huaxv/Huaxv-Tool/markdown-preview=enhanced/template.tex
    highlight: tango
    path: C:/Users/huaxv/Desktop/数据包大体模样.pdf
---

# 数据包大体模样

![Snipaste_2023-12-14_22-31-33](/assets/Snipaste_2023-12-14_22-31-33.png)

## 数据包的发送流程

### 1. 应用程序处理数据

对数据进行编码处理，可能会采用 `utf-8` 进行编码

### 2. TCP 模块的处理

TCP 根据应用的指示，负责建立连接、发送数据以及断开连接

TCP 提供将应用层发来的数据顺利发送至对端的可靠传输

在应用层数据前端附加一个『TCP首部』

TCP首部 包括源端口号、目标端口号、序号、校验和

### 3. IP 模块的处理

在 TCP首部 的前端加上自己的『IP首部』

IP首部中包含 接收端的IP地址 以及 发送端的IP地址；

IP 首部还要用来判断其后面数据是 TCP 还是 UDP 的信息

### 4. 网络接口（以太网驱动）的处理

以太网首部中包含接收端的 MAC 地址、发送端的 MAC 地址，以及标志以太网数据的协议

---

包从上层往下层流动时，每个包的首部都至少包含两个信息：发送端和接收端地址、上一层的协议类型

以太网会用 MAC地址、IP 会用 IP地址、TCP/UDP 会用端口号，识别两端主机的地址

![包结构简图](/assets/Snipaste_2023-12-14_22-49-31.png)

---

## 数据包的接收流程

包的接收流程，是发送流程的逆序过程

### 1. 网络接口（以太网驱动）的处理

主机收到以太网包后，先在以太网首部中找到 MAC地址 判断是否是发给自己的包

如果不是发给自己的包就「丢弃数据」

如果是自己的包，就在以太网包首部的类型域中确定以太网协议所传送过来的数据类型（例如，判断下一层是否是 IP协议）

如果以太网首部的类型域包含了一个无法识别的协议类型，就「丢弃数据」

### 2. IP 模块的处理

如果包首部的 IP地址 与自己的 IP地址匹配，就接收数据并从中查找出上一层的协议

如果是 TCP协议就送给 TCP处理，如果是 UDP就送给 UDP处理

对于有路由器的情况下，接收端IP地址 往往不是自己的地址，需要借助路由控制表，调查应该送达的主机或路由器以后再转发数据

### 3. TCP 模块的处理

在 TCP模块中，首先会计算一下校验和，判断数据是否被破坏

然后检查是否在按照序号接收数据

最后检查端口号，确定具体的应用程序

### 4. 应用端处理
