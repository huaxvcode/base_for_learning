---
title: 以太网帧格式
header-includes:
 - \usepackage{fvextra}
 - \DefineVerbatimEnvironment{Highlighting}{Verbatim}{breaklines,commandchars=\\\{\}}
output:
  pdf_document:
    latex_engine: xelatex
    toc: true
    template: C:/Huaxv/Huaxv-Tool/markdown-preview=enhanced/template.tex
    highlight: tango
    path: C:/Users/huaxv/Desktop/以太网帧格式.pdf
---

# 以太网帧格式

![Snipaste_2023-12-16_19-13-48](/assets/Snipaste_2023-12-16_19-13-48.png)

前两个字段分别是 $48$ 位的 目的MAC地址 和 源MAC地址

下个字段是 $2$ 字节的类型字段，用来标志上一层使用的是什么协议

第四个字段是数据字段，其长度在 $46 \sim 1500$ 字节之间，最小长度 $64$ 减去目的地址、源地址、类型、FCS的长度 $18$ 等于 $46$ 字节

最后一个字段是 $4$ 字节的帧检验序列 FCS

## 曼彻斯特编码、差分曼彻斯特编码

在曼彻斯特编码中，每一位的中间有一跳变

位中间的跳变既作时钟信号，又作数据信号

从高到低跳变表示"0"，从低到高跳变表示"1"（也可以反正来规定）

---

差分曼彻斯特编码，每位中间的跳变仅提供时钟定时

而用每位开始时有无跳变表示"0"或"1"

有跳变为"0"，无跳变为"1"

---

![Snipaste_2023-12-16_19-47-41](/assets/Snipaste_2023-12-16_19-47-41.png)

a 图是曼彻斯特编码

b 图是差分曼彻斯特编码

---

如果传送以太网帧已经到达尾部后，就不在输送 $0$ 和 $1$ 所以，此时的曼切斯特编码保持原有电压不变

通过这个就可以判断以太网帧的末尾在哪

## FCS 帧校验序列/循环冗余校验

循环冗余校验（CRC）字段位于尾部，有 $32$ 位

生成一个 $n$ 位的 CRC 校验码：

- 首先给被检测的信息尾部，添加 $n$ 位 $0$
- 然后除以一个 $n + 1$ 位的值，假设为 $p$，得到余数
- 该余数就是所求的 CRC 字段

对要发送的信息尾部，添加该余数，那么接收方接收到这个信息时，对该消息取模 $p$ 得到的值为 $0$ 就代表传输很大概率无差错！

例如：发送方要传输的数据为 $x$

- 发送方先和接收方约定一个除数为 $p$，该除数是 $r$ 位二进制数
- 发送方先对数据 $x$ 的末尾添加 $r - 1$ 位 $0$，即 $x << (r - 1)$
- 求出余数 $m = (x << (r - 1)) \bmod p$
- 则发送方发送数据：$y = (x << (r - 1)) + m$
- 接收方接收到数据 $y$，执行：$t = y \bmod p$，并判断 $t$ 是否为 $0$
  - 如果是 $0$，则传输很大概率没有问题
  - 否则丢弃
